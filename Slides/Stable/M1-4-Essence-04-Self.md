{"title" : "Inheritance and Lookup: Self","slidesid" : "M1S4","subtitle" : "Understand lookup once for all"}# Goals Understand:- Sending a message- Method lookup- Semantics of `self`/`this`# Remember inheritance- Inheritance of **state** is **static** \(done at compile time\)- Inheritance of **behavior** is **dynamic**- In this lecture we focus on the behavior part# Message sending<!columns|width=100<!column|width=38**Sending** a **message** is a two-step process:1. **look up** the **method** matching the message1. **execute** this method on the **receiver**!><!column|width=62![](figures/InheritanceDiagram-sendingMessage.pdf width=75)!>!># Method lookup<!columns|width=100<!column|width=38The lookup starts in the **class** of the **receiver** then:- if the method is defined in the class, it is returned- otherwise the search continues in the superclass!><!column|width=62![](figures/InheritanceDiagram-lookupTwoStages.pdf width=70)!>!># Some lookup cases<!columns|width=100<!column|width=47Sending the message `color` to `aColoredRectangle`!><!column|width=53![](figures/InheritanceDiagram-lookup-superclass.pdf width=60)!>!># Some lookup cases<!columns|width=100<!column|width=47Sending the message `area` to `aColoredRectangle`!><!column|width=53![](figures/InheritanceDiagram-lookup-superclass.pdf width=60)!>!># About lookup implementation- Most of the time, the result of a lookup is **cached** and a lookup happens only once- In some languages, there are dispatch tables- The point is that conceptually there is a lookup at execution# What is self/this?<!columns|width=100<!column|width=50![](figures/LookupWithSelfInSuperclassMethod.pdf width=80)!><!column|width=50- Take 5 min and write the definition of `self` \(`this` in Java\)- Your definition should have two points:  - what does `self` represent?  - how is a method looked up when a message is sent to `self`?!>!># Let us explore a bit<!columns|width=100<!column|width=60![](figures/LookupWithSelfInSuperclassMethod.pdf width=100)!><!column|width=40- `aA` is an instance of `A` \(obtained executing `A new`\)- `aB` is an instance of `B` \(obtained executing `B new`\)!>!># Let us explore a bit<!columns|width=100<!column|width=60![](figures/LookupWithSelfInSuperclassMethod.pdf width=100)!><!column|width=40```> aA foo...>	aB foo...```!>!># self always represents the receiver<!columns|width=100<!column|width=60![](figures/LookupWithSelfInSuperclassMethod.pdf width=100)!><!column|width=40```>	aA foo10> aB foo50```!>!># self always represents the receiver<!columns|width=100<!column|width=60![](figures/LookupWithSelfInSuperclassMethod.pdf width=100)!><!column|width=40```> aA bar...> aB bar...```!>!># self always represents the receiver<!columns|width=100<!column|width=60![](figures/LookupWithSelfInSuperclassMethod.pdf width=100)!><!column|width=40```> aA bar10> aB bar50```!>!># Following message lookup and execution<!columns|width=100<!column|width=40![](figures/LookupWithSelfInSuperclassMethod.pdf width=90)```> aB bar50```!><!column|width=65Evaluation of `aB bar`1. `aB`'s class is `B`1. no method `bar` in `B`1. look up in `A` - `bar` is found1. method `bar` is executed1. `self` refers to the receiver `aB`1. `foo` is sent to `self`1. look up `foo` in the `aB`'s class: `B`1. `foo` is found there and executed!>!># self/this in two sentences- `self` represents the **receiver** of the message  - `self` in Pharo, `this` in Java- The method lookup **starts in the class of the receiver**# self always represents the receiver<!columns|width=100<!column|width=60![](figures/LookupWithSelfInSuperclassMethodThreeClasses.pdf width=90)!><!column|width=40```> aA bar...> aB bar...> aC bar...```!>!># self always represents the receiver<!columns|width=100<!column|width=60![](figures/LookupWithSelfInSuperclassMethodThreeClasses.pdf width=90)!><!column|width=40```> aA bar10> aB bar10> aC bar50```!>!># What you should know- `self` always represents the receiver- Sending a message is a **two-step** process:  1. **Look up** the method matching the message  1. Execute this method **on the receiver**- Method lookup maps a message to a method- Method lookup starts in the **class of the receiver**  - ...and goes up in the hierarchy